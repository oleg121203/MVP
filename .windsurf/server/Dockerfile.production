# üê≥ Windsurf Enterprise MCP Server - –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
FROM node:18-alpine

# –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏
RUN apk add --no-cache postgresql-client redis

# –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
RUN addgroup -g 1001 -S windsurf && \
    adduser -S windsurf -u 1001

# –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–æ–±–æ—á—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
WORKDIR /app

# –ö–æ–ø—ñ—é—î–º–æ package files
COPY package*.json ./
COPY tsconfig.json ./

# –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
RUN npm ci --only=production

# –ö–æ–ø—ñ—é—î–º–æ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥
COPY src/ ./src/
COPY .env.example ./.env

# –ö–æ–º–ø—ñ–ª—é—î–º–æ TypeScript
RUN npm run build

# –ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ñ–∞–π–ª—ñ–≤
RUN chown -R windsurf:windsurf /app

# –ü–µ—Ä–µ–∫–ª—é—á–∞—î–º–æ—Å—è –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ windsurf
USER windsurf

# –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –ø–æ—Ä—Ç –¥–ª—è health check (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
EXPOSE 8080

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è MCP
ENV NODE_ENV=production
ENV REDIS_URL=redis://redis:6379
ENV DATABASE_URL=postgresql://ventai_dev:ventai_dev_password@postgres:5432/ventai_dev

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
  CMD redis-cli -h ${REDIS_HOST:-redis} ping || exit 1

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
CMD ["node", "dist/enterprise-index.js"]
